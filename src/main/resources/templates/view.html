<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Styled Inventory Page with 3D Model</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            padding: 20px;
            background-color: #121212; /* Dark background */
            color: #E0E0E0; /* Light text */
            margin: 0;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            background: rgba(30, 30, 30, 0.9);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        input[type="text"] {
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #1f1f1f;
            color: #ffffff;
            width: 300px;
        }

        button {
            background-color: #1F1F1F;
            color: #E0E0E0;
            padding: 10px 15px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        button:hover {
            background-color: #333;
            transform: translateY(-2px);
        }

        h1 {
            font-size: 1.8em;
            margin: 20px 0;
            border-bottom: 2px solid #444;
            padding-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            font-weight: 500;
            background-color: #2A2A2A;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        th:hover {
            background-color: #3A3A3A;
        }

        tr:hover {
            background-color: #444;
        }

        input[type="checkbox"] {
            accent-color: #6200EE; /* Custom checkbox color */
        }

        .failure-rate {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: background 0.3s;
        }

        .failure-rate:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        canvas {
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        /* 3D Model Container */
        #modelContainer {
            width: 100%;
            height: 100%; /* Adjust height as needed */
            margin-bottom: 30px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: flex-start;
            }

            input[type="text"] {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="failure-rate">
        Failure Probability: <span th:text="${failureRate} ?: 'N/A'"></span>
    </div>    

    <div class="controls">
        <input type="text" id="searchInput" placeholder="Search Inventory..." onkeyup="filterInventory()">
        <button>Add Item</button>
    </div>

    <h1>Inventory</h1>
    <table>
        <thead>
            <tr>
                <th><input type="checkbox" id="selectAll"></th>
                <th onclick="sortTable(1)">Name</th>
                <th onclick="sortTable(2)">Stock</th>
                <th onclick="sortTable(3)">Location</th>
                <th onclick="sortTable(4)">Category</th>
                <th onclick="sortTable(5)">Supplier</th>
                <th onclick="sortTable(6)">Price</th>
            </tr>
        </thead>
        <tbody id="inventoryTableBody">
            <tr th:each="item : ${inventory}">
                <td><input type="checkbox"></td>
                <td th:text="${item.name}"></td>
                <td th:text="${item.stock}"></td>
                <td th:text="${item.location}"></td>
                <td th:text="${item.category}"></td>
                <td th:text="${item.supplier}"></td>
                <td th:text="${item.price}"></td>
            </tr>
        </tbody>
    </table>

    <h1>Lanes</h1>
    <canvas id="laneChart" width="400" height="200"></canvas>

    <h1>3D Factory Model</h1>
    <div id="modelContainer"></div> <!-- Container for the 3D model -->
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
<script th:inline="javascript">
    var lanes = /*[[${lanes}]]*/ [];

    var labels = lanes.map(lane => lane.lane);
    var productionValues = lanes.map(lane => lane.production);

    var ctx = document.getElementById('laneChart').getContext('2d');

    function createGradient(ctx, index) {
        var gradient = ctx.createLinearGradient(0, 0, ctx.canvas.width, 0);
        gradient.addColorStop(0, `hsl(${index * 50}, 70%, 60%)`);
        gradient.addColorStop(1, `hsl(${index * 50}, 70%, 30%)`);
        return gradient;
    }

    var backgroundColors = labels.map((_, index) => createGradient(ctx, index));

    var chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Production (out of 1000)',
                data: productionValues,
                backgroundColor: backgroundColors,
                borderColor: backgroundColors,
                borderWidth: 1
            }]
        },
        options: {
            indexAxis: 'y',
            scales: {
                x: {
                    beginAtZero: true,
                    max: 1000
                }
            },
            onClick: (event, elements) => {
                if (elements.length > 0) {
                    var index = elements[0].index;
                    var laneName = labels[index];
                    window.location.href = '/laneDetails?lane=' + laneName;
                }
            }
        }
    });

    // 3D Model Setup
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, 1000); // Set the size of the renderer
    document.getElementById('modelContainer').appendChild(renderer.domElement);

    // Add lights to the scene
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5); // Soft white light
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 5, 5).normalize();
    scene.add(directionalLight);

    // Load the 3D model
    var loader = new THREE.GLTFLoader();
    loader.load('http://localhost:8080/3d_online_factory_1_knt/scene.gltf', function (gltf) { // Scale down the model if it's too large
        scene.add(gltf.scene);
        gltf.scene.position.set(0, 0, 0); // Adjust position as needed
    }, undefined, function (error) {
        console.error('An error happened while loading the model:', error);
    });

    camera.position.z = 5;

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }
    animate();

    // Handle window resize
    window.addEventListener('resize', function() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, 400);
    });
</script>

<script>
    document.getElementById('selectAll').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('table tbody input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });

    function sortTable(columnIndex) {
        let table = document.querySelector("table tbody");
        let rows = Array.from(table.rows);

        let sortedRows = rows.sort((a, b) => {
            let aText = a.cells[columnIndex].textContent.trim();
            let bText = b.cells[columnIndex].textContent.trim();

            return isNaN(aText) ? aText.localeCompare(bText) : aText - bText;
        });

        table.append(...sortedRows);
    }

    function filterInventory() {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();
        const rows = document.querySelectorAll('#inventoryTableBody tr');

        rows.forEach(row => {
            const name = row.cells[1].textContent.toLowerCase();
            const location = row.cells[3].textContent.toLowerCase();
            const category = row.cells[4].textContent.toLowerCase();
            const supplier = row.cells[5].textContent.toLowerCase();
            const isVisible = name.includes(searchInput) || location.includes(searchInput) || category.includes(searchInput) || supplier.includes(searchInput);
            row.style.display = isVisible ? '' : 'none';
        });
    }
</script>

</body>
</html>